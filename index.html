<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Work Flow</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0b1220;
  --glass:rgba(255,255,255,0.05);
  --panel:#111827;
  --accent:#22d3ee;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --danger:#ef4444;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,sans-serif;
  background:linear-gradient(160deg,#0b1220,#020617);
  color:var(--text);
}

/* NAVBAR */
nav{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 24px;
  background:#020617;
  box-shadow:0 8px 30px rgba(0,0,0,.6);
}
nav h1{margin:0;color:var(--accent);font-size:20px}

/* DASHBOARD KPI */
.nav-kpis{display:flex;gap:14px}
.nav-kpi{
  background:var(--glass);
  backdrop-filter:blur(10px);
  padding:8px 14px;
  border-radius:14px;
  text-align:center;
  min-width:95px;
  transition:.3s ease;
}
.nav-kpi:hover{
  transform:translateY(-2px);
  box-shadow:0 10px 28px rgba(34,211,238,.4);
}
.nav-kpi span{font-size:10px;color:var(--muted)}
.nav-kpi b{display:block;font-size:18px;margin-top:2px}

.nav-kpi.received b{color:#38bdf8}
.nav-kpi.selection b{color:#facc15}
.nav-kpi.quotation b{color:#fb7185}
.nav-kpi.completed b{color:#4ade80}

/* LAYOUT */
.container{max-width:1600px;margin:auto;padding:20px}
.card{
  background:var(--glass);
  backdrop-filter:blur(12px);
  border-radius:18px;
  padding:18px;
  margin-bottom:20px;
  box-shadow:0 20px 50px rgba(0,0,0,.6);
}
h3{margin:0 0 16px 0;color:var(--accent)}

.form-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:14px;
}

/* FORM */
input,select,textarea{
  width:100%;
  padding:10px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.1);
  background:rgba(255,255,255,.05);
  color:var(--text);
  transition:.3s ease;
}
input:focus,select:focus,textarea:focus{
  outline:none;
  border:1px solid var(--accent);
  box-shadow:0 0 12px rgba(34,211,238,.5);
}

button{
  padding:8px 14px;
  border-radius:10px;
  border:none;
  font-weight:600;
  cursor:pointer;
}
button.primary{
  background:linear-gradient(135deg,#22d3ee,#0ea5e9);
  color:#002;
}
button.primary:hover{
  transform:translateY(-2px);
  box-shadow:0 8px 20px rgba(34,211,238,.5);
}
button.danger{
  background:linear-gradient(135deg,#ef4444,#dc2626);
  color:#fff;
}

/* TABLE */
.table-wrap{overflow-x:auto}
table{
  width:100%;
  border-collapse:collapse;
  font-size:12px;
  min-width:1200px;
}
th,td{
  padding:8px;
  border-bottom:1px solid rgba(255,255,255,.1);
  text-align:center;
}
th{color:var(--accent)}

textarea{resize:vertical;min-height:40px}
</style>
</head>

<body>

<nav>
  <h1>My Work Flow</h1>
  <div id="navKpis" class="nav-kpis"></div>
</nav>

<div class="container">

<!-- ADD PROJECT -->
<div class="card">
  <h3>Add Project</h3>
  <div class="form-grid">
    <input id="project" placeholder="Project Name">

    <!-- SMART CUSTOMER -->
    <input id="customer" list="customerList" placeholder="Customer Name">
    <datalist id="customerList"></datalist>

    <!-- UPDATED COIL TYPES -->
    <select id="type">
      <option>CHW</option>
      <option>DX</option>
      <option>CHW COMBI</option>
      <option>DX COMBI</option>
      <option>CHW + CHW COMBI</option>
      <option>DX + DX COMBI</option>
    </select>

    <input type="date" id="received">
    <button id="addBtn" class="primary">Add</button>
  </div>
</div>

<!-- PROJECT LIST -->
<div class="card">
  <h3>Projects</h3>

  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Project</th>
          <th>Customer</th>
          <th>Type</th>
          <th>Recv</th>
          <th>Sent</th>
          <th>Status</th>
          <th>Rev</th>
          <th>QID-CC</th>
          <th>QID-HP</th>
          <th>Remarks</th>
          <th>Save</th>
          <th>Del</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
</div>

</div>

<script>
const $ = id => document.getElementById(id);

let projects = JSON.parse(localStorage.getItem('hvacProjects')) || [];
let customers = JSON.parse(localStorage.getItem('customerMaster')) || [];

function saveAll(){
  localStorage.setItem('hvacProjects', JSON.stringify(projects));
  localStorage.setItem('customerMaster', JSON.stringify(customers));
}

function updateCustomerList(){
  $('customerList').innerHTML =
    customers.map(c=>`<option value="${c}">`).join('');
}

$('addBtn').onclick = () => {
  const p=$('project').value.trim();
  const c=$('customer').value.trim();
  const t=$('type').value;
  const r=$('received').value;

  if(!p||!c||!r){alert('Fill all fields');return;}

  if(!customers.includes(c)){
    customers.push(c);
  }

  projects.push({
    id:Date.now(),
    project:p,
    customer:c,
    type:t,
    received:r,
    sent:'',
    status:'RECEIVED',
    revision:0,
    quoteCC:'',
    quoteHP:'',
    remarks:'',
    updated:Date.now()
  });

  saveAll();
  updateCustomerList();
  $('project').value=$('customer').value=$('received').value='';
  render();
};

function render(){
  const list=[...projects].sort((a,b)=>new Date(b.received)-new Date(a.received));

  const k={RECEIVED:list.length,'SELECTION SENT':0,'QUOTATION SENT':0,COMPLETED:0};
  list.forEach(x=>{if(k[x.status]!==undefined&&x.status!=='RECEIVED')k[x.status]++;});

  $('navKpis').innerHTML=`
    <div class="nav-kpi received"><span>RECEIVED</span><b>${k.RECEIVED}</b></div>
    <div class="nav-kpi selection"><span>SELECTION SENT</span><b>${k['SELECTION SENT']}</b></div>
    <div class="nav-kpi quotation"><span>QUOTATION SENT</span><b>${k['QUOTATION SENT']}</b></div>
    <div class="nav-kpi completed"><span>COMPLETED</span><b>${k.COMPLETED}</b></div>
  `;

  $('tbody').innerHTML='';
  list.forEach(x=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${x.project}</td>
      <td>${x.customer}</td>
      <td>${x.type}</td>
      <td>${x.received}</td>
      <td><input type="date" value="${x.sent}"></td>
      <td>
        <select>
          ${['RECEIVED','SELECTION SENT','QUOTATION SENT','COMPLETED']
            .map(s=>`<option ${s===x.status?'selected':''}>${s}</option>`).join('')}
        </select>
      </td>
      <td><input type="number" value="${x.revision}"></td>
      <td><input value="${x.quoteCC||''}"></td>
      <td><input value="${x.quoteHP||''}"></td>
      <td><textarea>${x.remarks||''}</textarea></td>
      <td><button class="primary">Save</button></td>
      <td><button class="danger">Del</button></td>
    `;

    tr.children[10].onclick=()=>{
      const f=tr.querySelectorAll('input,select,textarea');
      x.sent=f[0].value;
      x.status=f[1].value;
      x.revision=f[2].value;
      x.quoteCC=f[3].value;
      x.quoteHP=f[4].value;
      x.remarks=f[5].value;
      x.updated=Date.now();
      saveAll();render();
    };

    tr.children[11].onclick=()=>{
      if(confirm('Delete project?')){
        projects=projects.filter(p=>p.id!==x.id);
        saveAll();render();
      }
    };

    $('tbody').appendChild(tr);
  });
}

updateCustomerList();
render();
</script>

</body>
</html>
