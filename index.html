<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>My Work Flow</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0b1220;
  --panel:#111827;
  --card:#0f172a;
  --accent:#22d3ee;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --danger:#ef4444;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,sans-serif;
  background:linear-gradient(180deg,#0b1220,#020617);
  color:var(--text);
}
nav{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:12px 20px;
  background:#020617;
  box-shadow:0 6px 20px rgba(0,0,0,.6);
}
nav h1{margin:0;font-size:18px;color:var(--accent)}
.nav-kpis{display:flex;gap:12px}
.nav-kpi{
  background:var(--panel);
  padding:6px 10px;
  border-radius:10px;
  text-align:center;
  min-width:90px;
}
.nav-kpi span{font-size:10px;color:var(--muted)}
.nav-kpi b{font-size:16px;color:var(--accent)}

.container{max-width:1500px;margin:auto;padding:16px}
.card{
  background:var(--panel);
  border-radius:14px;
  padding:14px;
  margin-bottom:14px;
  box-shadow:0 14px 36px rgba(0,0,0,.6);
}
h3{margin:0 0 10px 0;color:var(--accent);font-size:14px}

input,select,textarea,button{
  font-family:inherit;
  padding:6px 7px;
  border-radius:8px;
  border:none;
  background:var(--card);
  color:var(--text);
  font-size:11px;
  box-shadow:inset 0 0 0 1px rgba(255,255,255,.12);
}
textarea{resize:vertical;min-height:28px}
button{
  background:var(--accent);
  color:#022;
  font-weight:600;
  cursor:pointer;
}
button.danger{background:var(--danger);color:#fff}

.form-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:8px;
}
.filters{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-bottom:10px;
}
.table-wrap{overflow-x:hidden}
table{
  width:100%;
  border-collapse:collapse;
  font-size:11px;
  table-layout:fixed;
}
th,td{
  padding:6px;
  border-bottom:1px solid rgba(255,255,255,.1);
  text-align:center;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
th{color:var(--accent)}
.col-small{width:55px}
.col-remarks{width:160px}
</style>
</head>

<body>

<nav>
  <h1>My Work Flow</h1>
  <div id="navKpis" class="nav-kpis"></div>
</nav>

<div class="container">

<!-- ADD PROJECT -->
<div class="card">
  <h3>Add Project</h3>
  <div class="form-grid">
    <input id="project" placeholder="Project Name">
    <input id="customer" placeholder="Customer Name">
    <select id="type">
      <option>Cooling Coil</option>
      <option>Heat Pipe</option>
      <option>Combi Coil</option>
      <option>FAHU</option>
      <option>AHU</option>
    </select>
    <input type="date" id="received">
    <button id="addBtn">Add</button>
  </div>
</div>

<!-- PROJECT LIST -->
<div class="card">
  <h3>Projects List</h3>

  <div class="filters">
    <input id="search" placeholder="Search project / customer">
    <input type="date" id="filterDate">
    <select id="filterStatus">
      <option value="">All Status</option>
      <option>RECEIVED</option>
      <option>SELECTION SENT</option>
      <option>QUOTATION SENT</option>
      <option>COMPLETED</option>
    </select>
    <select id="filterRevision">
      <option value="">All</option>
      <option value="revised">Only Revised</option>
    </select>
  </div>

  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Project</th><th>Customer</th><th>Type</th>
          <th>Recv</th><th>Sent</th><th>Status</th>
          <th class="col-small">Rev</th>
          <th>QID-CC</th><th>QID-HP</th>
          <th class="col-remarks">Remarks</th>
          <th class="col-small">Save</th>
          <th class="col-small">Del</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
</div>

</div>

<script>
const $ = id => document.getElementById(id);

let projects = JSON.parse(localStorage.getItem('hvacProjects')) || [];

function saveAll(){
  localStorage.setItem('hvacProjects', JSON.stringify(projects));
}

$('addBtn').addEventListener('click', () => {
  const p = $('project').value.trim();
  const c = $('customer').value.trim();
  const t = $('type').value;
  const r = $('received').value;

  if(!p || !c || !r){
    alert('Fill all fields');
    return;
  }

  projects.push({
    project:p, customer:c, type:t,
    received:r, sent:'',
    status:'RECEIVED', revision:0,
    quoteCC:'', quoteHP:'',
    remarks:'', updated:Date.now()
  });

  saveAll();
  $('project').value = $('customer').value = $('received').value = '';
  render();
});

function render(){
  const s = $('search').value.toLowerCase();
  const fd = $('filterDate').value;
  const fs = $('filterStatus').value;
  const fr = $('filterRevision').value;

  const list = projects
    .filter(x =>
      (!s || x.project.toLowerCase().includes(s) || x.customer.toLowerCase().includes(s)) &&
      (!fd || x.received === fd) &&
      (!fs || x.status === fs) &&
      (!fr || (fr === 'revised' && x.revision > 0))
    )
    .sort((a,b)=>new Date(b.received)-new Date(a.received)||(b.updated||0)-(a.updated||0));

  // NAV DASHBOARD
  const k = { RECEIVED:list.length,'SELECTION SENT':0,'QUOTATION SENT':0,COMPLETED:0 };
  list.forEach(x=>{ if(k[x.status]!==undefined && x.status!=='RECEIVED') k[x.status]++; });

  $('navKpis').innerHTML = Object.entries(k)
    .map(([k,v])=>`<div class="nav-kpi"><span>${k}</span><b>${v}</b></div>`)
    .join('');

  $('tbody').innerHTML = '';
  list.forEach((x,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${x.project}</td>
      <td>${x.customer}</td>
      <td>${x.type}</td>
      <td>${x.received}</td>
      <td><input type="date" value="${x.sent}"></td>
      <td>
        <select>
          ${['RECEIVED','SELECTION SENT','QUOTATION SENT','COMPLETED']
            .map(s=>`<option ${s===x.status?'selected':''}>${s}</option>`).join('')}
        </select>
      </td>
      <td><input type="number" value="${x.revision}"></td>
      <td><input value="${x.quoteCC}"></td>
      <td><input value="${x.quoteHP}"></td>
      <td><textarea>${x.remarks}</textarea></td>
      <td><button>Save</button></td>
      <td><button class="danger">Del</button></td>
    `;

    tr.children[10].onclick = () => {
      const f = tr.querySelectorAll('input,select,textarea');
      x.sent=f[0].value; x.status=f[1].value;
      x.revision=f[2].value; x.quoteCC=f[3].value;
      x.quoteHP=f[4].value; x.remarks=f[5].value;
      x.updated=Date.now(); saveAll(); render();
    };

    tr.children[11].onclick = () => {
      if(confirm('Delete project?')){
        projects.splice(i,1);
        saveAll(); render();
      }
    };

    $('tbody').appendChild(tr);
  });
}

['search','filterDate','filterStatus','filterRevision']
  .forEach(id=>$(id).addEventListener('input',render));

render();
</script>

</body>
</html>
