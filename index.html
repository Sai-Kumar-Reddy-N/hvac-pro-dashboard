<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Work Flow</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Inter,sans-serif;background:#0f2027;color:white}

.glass{
  background:rgba(255,255,255,0.08);
  backdrop-filter:blur(14px);
  border:1px solid rgba(255,255,255,0.15);
  box-shadow:0 8px 32px rgba(0,0,0,0.3);
}

nav{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:16px 30px;
  position:sticky;
  top:0;
}

.nav-kpis{display:flex;gap:30px}
.kpi{text-align:center}
.kpi span{font-size:11px;opacity:.7;display:block}
.kpi b{font-size:18px}

.container{max-width:1600px;margin:auto;padding:30px}

.card{padding:20px;border-radius:16px;margin-bottom:30px}

.form-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:15px;
}

input,select,textarea{
  padding:8px;border-radius:8px;border:none;
  background:rgba(255,255,255,.15);
  color:white;
}

button{
  background:#00c6ff;border:none;padding:8px 16px;
  border-radius:20px;cursor:pointer;
}

.tile-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(260px,300px));
  gap:25px;
}

.tile{
  padding:18px;border-radius:18px;
  transition:.3s ease;cursor:pointer;
}
.tile:hover{transform:translateY(-5px)}

.small{font-size:11px;opacity:.7;margin-top:4px}

.badge{
  display:inline-block;
  padding:3px 8px;
  font-size:9px;
  border-radius:12px;
  margin-top:6px;
  margin-right:4px;
}

.selection{background:#2ecc71;}
.quotation{background:#3498db;}

.details{margin-top:10px;display:none;font-size:11px}
.tile.expanded .details{display:block}
</style>
</head>

<body>

<nav class="glass">
  <h1>My Work Flow</h1>
  <div class="nav-kpis" id="navKpis"></div>
</nav>

<div class="container">

<div class="card glass">
  <div class="form-grid">
    <input id="project" placeholder="Project Name">
    <input id="customer" placeholder="Customer Name">
    <select id="coilType">
      <option>CHW</option>
      <option>DX</option>
      <option>CHW COMBI</option>
      <option>DX COMBI</option>
      <option>CHW + CHW COMBI</option>
      <option>DX + DX COMBI</option>
    </select>
    <input type="date" id="received">
    <button id="addBtn">Add</button>
  </div>
</div>

<div class="tile-grid" id="tileGrid"></div>

</div>

<script>
const $=id=>document.getElementById(id);
let projects=JSON.parse(localStorage.getItem('hvacProjects'))||[];

/* ===== STRONG DATA MIGRATION ===== */
projects = projects.map(p => {

  if(typeof p.selection !== "undefined") return p;

  let selection=false;
  let quotation=false;

  if(p.status){
    const s=p.status.toLowerCase();

    if(s.includes("selection") && !s.includes("quotation")){
      selection=true;
    }
    if(s.includes("quotation")){
      quotation=true;
    }
    if(s.includes("both")){
      selection=true;
      quotation=true;
    }
  }

  return {
    ...p,
    selection:selection,
    quotation:quotation,
    sent:p.sent||"",
    remarks:p.remarks||""
  };
});

localStorage.setItem('hvacProjects',JSON.stringify(projects));

/* ===== ADD ===== */
$('addBtn').onclick=()=>{
  const p=$('project').value.trim();
  const c=$('customer').value.trim();
  const t=$('coilType').value;
  const r=$('received').value;
  if(!p||!c||!r)return;

  projects.push({
    id:Date.now(),
    project:p,
    customer:c,
    type:t,
    received:r,
    sent:'',
    selection:false,
    quotation:false,
    remarks:''
  });

  save();
  render();
};

function save(){
  localStorage.setItem('hvacProjects',JSON.stringify(projects));
}

/* ===== RENDER ===== */
function render(){

  const rec=projects.length;

  const sel=projects.filter(p =>
    p.selection===true && p.quotation===false
  ).length;

  const quo=projects.filter(p =>
    p.quotation===true
  ).length;

  $('navKpis').innerHTML=`
    <div class="kpi"><span>Received</span><b>${rec}</b></div>
    <div class="kpi"><span>Selection</span><b>${sel}</b></div>
    <div class="kpi"><span>Quotation</span><b>${quo}</b></div>
  `;

  $('tileGrid').innerHTML='';

  projects.sort((a,b)=>new Date(b.received)-new Date(a.received));

  projects.forEach(p=>{

    let badges='';
    if(p.selection && !p.quotation)
      badges+=`<span class="badge selection">Selection Sent</span>`;
    if(p.quotation)
      badges+=`<span class="badge quotation">Quotation Sent</span>`;

    const tile=document.createElement('div');
    tile.className='tile glass';
    tile.innerHTML=`
      <h3 onclick="this.closest('.tile').classList.toggle('expanded')">${p.project}</h3>
      <div class="small">${p.customer}</div>
      <div class="small">Type: ${p.type}</div>
      <div class="small">Received: ${p.received}</div>
      <div class="small">Sent: ${p.sent||'-'}</div>
      ${badges}

      <div class="details">
        <input type="date" value="${p.sent||''}"
          onchange="update(${p.id},'sent',this.value)">
        <div>
          <label><input type="checkbox" ${p.selection?'checked':''}
            onchange="update(${p.id},'selection',this.checked)"> Selection</label>
          <label><input type="checkbox" ${p.quotation?'checked':''}
            onchange="update(${p.id},'quotation',this.checked)"> Quotation</label>
        </div>
        <textarea onchange="update(${p.id},'remarks',this.value)">${p.remarks||''}</textarea>
        <div style="color:red;cursor:pointer"
          onclick="deleteProject(${p.id})">Delete</div>
      </div>
    `;
    $('tileGrid').appendChild(tile);
  });
}

function update(id,key,value){
  const p=projects.find(x=>x.id===id);
  p[key]=value;
  save();
  render();
}

function deleteProject(id){
  projects=projects.filter(x=>x.id!==id);
  save();
  render();
}

render();
</script>

</body>
</html>
